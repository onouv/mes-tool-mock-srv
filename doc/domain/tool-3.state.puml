@startuml
'https://plantuml.com/state-diagram
skinparam defaultTextAlignment left
scale 350 width

[*] --> UP
state DOWN : entry/ issue ToolDownEvent

state UP {
    state UP: entry/ ToolUpEventAction, ToolUpEvent(tool)
    state UP: PART_LOADING / LoadPartAction, PartLoadedEvt(tool, part)
    state UP: PART_UNLOADING / UnloadPartAction, PartUnloadedEvt(tool, part)

    state STOPPED
    STOPPED: entry / ToolStoppedEvent(tool)
    state IDLE
    state OPERATING {
        state PROCESSING_PART
        state LOADING_PROCESS
        state LOADING_PROCESS: entry/ ProcessNewPartAction, PartInProcessEvent(tool, part)

        state UNLOADING_PROCESS

        [*] --> PROCESSING_PART
        PROCESSING_PART --> LOADING_PROCESS: [ProcessEmpty]
        LOADING_PROCESS --> PROCESSING_PART

        PROCESSING_PART --> UNLOADING_PROCESS: [await cycle time] / \nEjectFinishedPartAction, \nPartProcessedEvent(tool, part), \nFINISHED
        UNLOADING_PROCESS --> LOADING_PROCESS: [FlowIsFree]

    }

    [*] --> STOPPED
    STOPPED --> OPERATING: START [FlowIsFree]
    STOPPED --> IDLE: START [InportEmpty] / \nToolIdleEvt(tool, UPSTREAM)
    STOPPED --> IDLE: START [OutportFull] / \nToolIdleEvt(tool, DOWNSTREAM)
    OPERATING --> STOPPED: STOP
    OPERATING --> IDLE: FINISHED: \n[InportEmpty] / \nToolIdleEvent(UPSTREAM)
    OPERATING --> IDLE: FINISHED: \n[OutportFull] / \nToolIdleEvent(DOWNSTREAM)

    IDLE --> OPERATING: [FlowIsFree]
    IDLE --> STOPPED: STOP
}

UP --> DOWN: FAULT
DOWN --> UP: FAULT_CLEAR
@enduml